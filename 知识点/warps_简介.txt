`@wraps(func)` æ˜¯ Python æ ‡å‡†åº“ `functools` ä¸­ä¸€ä¸ªæå…¶é‡è¦å’Œå¸¸ç”¨çš„è£…é¥°å™¨å·¥å‚ï¼ˆDecorator Factoryï¼‰ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯**åœ¨åˆ›å»ºè£…é¥°å™¨æ—¶ï¼Œä¿ç•™è¢«è£…é¥°å‡½æ•°çš„å…ƒæ•°æ®ï¼ˆMetadataï¼‰**ã€‚

---

### 1. é—®é¢˜çš„æ ¹æºï¼šæ™®é€šè£…é¥°å™¨ä¼šâ€œä¸¢å¤±â€å…ƒæ•°æ®

å½“ä½ å†™ä¸€ä¸ªè£…é¥°å™¨æ—¶ï¼Œå¦‚æœä¸ä½¿ç”¨ `@wraps`ï¼Œä¼šå¯¼è‡´è¢«è£…é¥°å‡½æ•°çš„ä¸€äº›é‡è¦ä¿¡æ¯è¢«è£…é¥°å™¨å†…éƒ¨çš„åŒ…è£…å‡½æ•°æ‰€è¦†ç›–ã€‚

```python
def my_decorator(func):
    def wrapper(*args, **kwargs):
        """åŒ…è£…å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²"""
        print(f"è°ƒç”¨å‡½æ•°: {func.__name__}")
        return func(*args, **kwargs)
    return wrapper

@my_decorator
def greet(name):
    """å‘æŸäººé—®å¥½"""
    return f"Hello, {name}!"

# ç°åœ¨æ£€æŸ¥ greet å‡½æ•°çš„å…ƒæ•°æ®
print(greet.__name__)        # è¾“å‡º: wrapper (æœŸæœ›æ˜¯ 'greet')
print(greet.__doc__)         # è¾“å‡º: åŒ…è£…å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸² (æœŸæœ›æ˜¯ 'å‘æŸäººé—®å¥½')
print(greet.__module__)      # å¯èƒ½æ­£ç¡®ï¼Œä½†å…¶ä»–å±æ€§ä¸¢å¤±
```

å¯ä»¥çœ‹åˆ°ï¼Œ`greet` çš„ `__name__` å’Œ `__doc__` éƒ½å˜æˆäº† `wrapper` å‡½æ•°çš„ï¼Œè¿™ç ´åäº†å‡½æ•°çš„â€œèº«ä»½â€å’Œæ–‡æ¡£ï¼Œå¯¹è°ƒè¯•ã€æ—¥å¿—è®°å½•ã€æ–‡æ¡£ç”Ÿæˆå·¥å…·ï¼ˆå¦‚ Sphinxï¼‰ç­‰éå¸¸ä¸åˆ©ã€‚

---

### 2. `@wraps(func)` çš„åŠŸèƒ½

`@wraps(func)` å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿçš„ã€‚å½“ä½ åœ¨è£…é¥°å™¨å†…éƒ¨çš„ `wrapper` å‡½æ•°ä¸Šä½¿ç”¨ `@wraps(func)` æ—¶ï¼Œå®ƒä¼š**è‡ªåŠ¨å°†åŸå‡½æ•° `func` çš„å…³é”®å…ƒæ•°æ®å¤åˆ¶åˆ° `wrapper` å‡½æ•°ä¸Š**ã€‚

è¿™æ ·ï¼Œä»å¤–éƒ¨çœ‹ï¼Œè¢«è£…é¥°çš„å‡½æ•°ä¾ç„¶â€œè¡¨ç°å¾—åƒâ€å®ƒè‡ªå·±ã€‚

#### ä¸»è¦å¤åˆ¶çš„å…ƒæ•°æ®åŒ…æ‹¬ï¼š

*   `__name__` : å‡½æ•°å
*   `__qualname__` : é™å®šåç§°ï¼ˆåœ¨åµŒå¥—å‡½æ•°/ç±»æ–¹æ³•ä¸­å¾ˆé‡è¦ï¼‰
*   `__module__` : å®šä¹‰å‡½æ•°çš„æ¨¡å—å
*   `__doc__` : æ–‡æ¡£å­—ç¬¦ä¸² (docstring)
*   `__annotations__` : ç±»å‹æ³¨è§£
*   `__dict__` : å‡½æ•°çš„å±æ€§å­—å…¸ï¼ˆ`wrapper.__dict__.update(func.__dict__)`ï¼‰
*   è¿˜ä¼šæ­£ç¡®è®¾ç½® `__wrapped__` å±æ€§ï¼ŒæŒ‡å‘åŸå§‹å‡½æ•°ã€‚

---

### 3. `@wraps(func)` çš„æºä»£ç åˆ†æ

`@wraps` çš„æºä»£ç ä½äº Python æ ‡å‡†åº“çš„ `functools.py` ä¸­ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒå®ç°çš„ç®€åŒ–å’Œæ³¨é‡Šç‰ˆæœ¬ï¼š

```python
# functools.py (ç®€åŒ–ç‰ˆ)
from functools import.WRAPPER_ASSIGNMENTS, WRAPPER_UPDATES

def wraps(wrapped,
          assigned = WRAPPER_ASSIGNMENTS,
          updated = WRAPPER_UPDATES):
    """
    Decorator factory to apply update_wrapper() to a wrapper function

    Returns a decorator that invokes update_wrapper() with the decorated
    function as the wrapper argument and the arguments to wraps() as the
    remaining arguments. Default arguments are as for update_wrapper().
    This is a convenience function to simplify applying partial() to
    update_wrapper().
    """
    # `wraps` æ˜¯ä¸€ä¸ªè£…é¥°å™¨å·¥å‚ï¼Œå®ƒè¿”å›ä¸€ä¸ªçœŸæ­£çš„è£…é¥°å™¨ã€‚
    # è¿™ä¸ªè¿”å›çš„è£…é¥°å™¨ä¼šæ¥æ”¶ `wrapper` å‡½æ•°ä½œä¸ºå‚æ•°ã€‚
    return update_wrapper

# --- update_wrapper æ˜¯çœŸæ­£çš„â€œå·¥ä½œâ€å‡½æ•° ---
def update_wrapper(wrapper,
                   wrapped,
                   assigned = WRAPPER_ASSIGNMENTS,
                   updated = WRAPPER_UPDATES):
    """
    Update a wrapper function to look like the wrapped function

       wrapper -- the function to be updated
       wrapped -- the original function
       assigned -- tuple naming the attributes assigned directly
       from the wrapped function to the wrapper function (defaults to
       functools.WRAPPER_ASSIGNMENTS)
       updated -- tuple naming the attributes of the wrapper that
       are updated with the corresponding attribute from the wrapped
       function (defaults to functools.WRAPPER_UPDATES)
    """
    # å°† wrapped å‡½æ•°çš„å…³é”®å±æ€§å¤åˆ¶åˆ° wrapper å‡½æ•°ä¸Š
    for attr in assigned:
        # getattr(wrapped, attr, None) è·å– wrapped çš„å±æ€§ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› None
        # setattr(wrapper, attr, ...) å°†å€¼è®¾ç½®åˆ° wrapper ä¸Š
        setattr(wrapper, attr, getattr(wrapped, attr, None))
    
    # å°† wrapped å‡½æ•°çš„ __dict__ æ›´æ–°åˆ° wrapper çš„ __dict__ ä¸­
    for attr in updated:
        getattr(wrapper, attr).update(getattr(wrapped, attr, {}))
    
    # Important: è®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼ŒæŒ‡å‘åŸå§‹å‡½æ•°
    wrapper.__wrapped__ = wrapped
    
    # è¿”å› wrapper å‡½æ•°ï¼Œä»¥ä¾¿å¯ä»¥ç»§ç»­ä½¿ç”¨
    return wrapper

# --- é»˜è®¤è¦å¤åˆ¶å’Œæ›´æ–°çš„å±æ€§ ---
WRAPPER_ASSIGNMENTS = ('__module__', '__name__', '__qualname__', '__doc__',
                       '__annotations__')
WRAPPER_UPDATES = ('__dict__',)
```

#### å…³é”®ç‚¹è§£æ

1.  **`wraps` æ˜¯ä¸€ä¸ªå·¥å‚**: `wraps(func)` è°ƒç”¨åï¼Œå®ƒè¿”å› `update_wrapper` å‡½æ•°ã€‚æ‰€ä»¥ `@wraps(func)` å®é™…ä¸Šç­‰ä»·äº `@update_wrapper`ï¼Œå¹¶ä¸” `update_wrapper` çš„ `wrapped` å‚æ•°å°±æ˜¯ `func`ã€‚
2.  **`update_wrapper` æ‰§è¡Œå¤åˆ¶**: å®ƒéå† `WRAPPER_ASSIGNMENTS` å…ƒç»„ä¸­çš„å±æ€§åï¼ˆå¦‚ `'__name__'`, `'__doc__'`ï¼‰ï¼Œä½¿ç”¨ `getattr` ä» `wrapped` å‡½æ•°è·å–è¿™äº›å±æ€§çš„å€¼ï¼Œç„¶åç”¨ `setattr` å°†è¿™äº›å€¼è®¾ç½®åˆ° `wrapper` å‡½æ•°ä¸Šã€‚
3.  **`__dict__` çš„ç‰¹æ®Šå¤„ç†**: `__dict__` å­˜å‚¨äº†å‡½æ•°çš„è‡ªå®šä¹‰å±æ€§ã€‚`update_wrapper` ä¼šè·å– `wrapper.__dict__` å’Œ `wrapped.__dict__`ï¼Œç„¶åç”¨åè€…çš„å†…å®¹æ›´æ–°å‰è€…ï¼ˆ`wrapper.__dict__.update(wrapped.__dict__)`ï¼‰ã€‚
4.  **`__wrapped__` å±æ€§**: è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å±æ€§ï¼Œå®ƒæ˜ç¡®åœ°æŒ‡å‘äº†è¢«åŒ…è£…çš„åŸå§‹å‡½æ•°ã€‚ä½ å¯ä»¥é€šè¿‡ `my_decorated_function.__wrapped__` æ¥è®¿é—®åŸå§‹çš„ã€æœªè¢«è£…é¥°çš„å‡½æ•°ã€‚

---

### 4. æ­£ç¡®ä½¿ç”¨ `@wraps(func)`

```python
from functools import wraps

def my_decorator(func):
    @wraps(func)  # ğŸ‘ˆ å…³é”®ï¼šåœ¨ wrapper ä¸Šåº”ç”¨ @wraps
    def wrapper(*args, **kwargs):
        """åŒ…è£…å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²"""
        print(f"è°ƒç”¨å‡½æ•°: {func.__name__}")
        return func(*args, **kwargs)
    return wrapper

@my_decorator
def greet(name):
    """å‘æŸäººé—®å¥½"""
    return f"Hello, {name}!"

# ç°åœ¨æ£€æŸ¥ greet å‡½æ•°çš„å…ƒæ•°æ®
print(greet.__name__)        # è¾“å‡º: greet (æ­£ç¡®ï¼)
print(greet.__doc__)         # è¾“å‡º: å‘æŸäººé—®å¥½ (æ­£ç¡®ï¼)
print(greet.__module__)      # è¾“å‡º: æ¨¡å—å (æ­£ç¡®ï¼)

# è®¿é—®åŸå§‹å‡½æ•° (å¦‚æœéœ€è¦)
original_greet = greet.__wrapped__
print(original_greet("World")) # è¾“å‡º: Hello, World!
```

ç°åœ¨ï¼Œ`greet` å‡½æ•°çš„å…ƒæ•°æ®è¢«å®Œç¾åœ°ä¿ç•™äº†ï¼ŒåŒæ—¶ `__wrapped__` å±æ€§ä¹Ÿæä¾›äº†å¯¹åŸå§‹å‡½æ•°çš„è®¿é—®ã€‚

---

### 5. æ€»ç»“

*   **åŠŸèƒ½**: `@wraps(func)` ç”¨äºåœ¨ç¼–å†™è£…é¥°å™¨æ—¶ï¼Œç¡®ä¿è¢«è£…é¥°å‡½æ•°çš„å…ƒæ•°æ®ï¼ˆå¦‚ `__name__`, `__doc__`ï¼‰ä¸è¢«è£…é¥°å™¨å†…éƒ¨çš„åŒ…è£…å‡½æ•°æ‰€è¦†ç›–ï¼Œä¿æŒå‡½æ•°çš„â€œèº«ä»½â€ã€‚
*   **æ¥æº**: Python æ ‡å‡†åº“ `functools` æ¨¡å—ã€‚
*   **åŸç†**: å®ƒæ˜¯ä¸€ä¸ªè£…é¥°å™¨å·¥å‚ï¼Œå…¶æ ¸å¿ƒæ˜¯ `update_wrapper` å‡½æ•°ã€‚è¯¥å‡½æ•°é€šè¿‡ `setattr` å’Œ `getattr` å°†åŸå‡½æ•°çš„å…³é”®å±æ€§å¤åˆ¶åˆ°åŒ…è£…å‡½æ•°ä¸Šï¼Œå¹¶è®¾ç½® `__wrapped__` å±æ€§ã€‚
*   **å¿…è¦æ€§**: **å¼ºçƒˆå»ºè®®**åœ¨ç¼–å†™ä»»ä½•é trivial çš„è£…é¥°å™¨æ—¶éƒ½ä½¿ç”¨ `@wraps(func)`ã€‚å®ƒæ˜¯ç¼–å†™ä¸“ä¸šã€å¥å£®çš„ Python ä»£ç çš„è‰¯å¥½å®è·µã€‚